@using Intersect.Extensions
@model PlayerCardModel

@{
    var player = Model.Player;
    if (player == default)
    {
        return;
    }

    var nameColor = player.NameColor.ToArgb();
    var styleParts = new[] { nameColor != 0 ? $"color: #{nameColor:X6}" : string.Empty };
    styleParts = styleParts.Where(part => !string.IsNullOrWhiteSpace(part)).ToArray();
}

<article class="player card">
    @if (Model.Rank.HasValue)
    {
        var rankStyleParts = new List<string>();
        if (Model.RankScale.HasValue)
        {
            rankStyleParts.Add($"width: {(int)Math.Ceiling(1 + Math.Log10(Model.RankScale.Value))}em");
        }
        <section class="column rank">
            <div class="rank-number">#@Model.Rank.Value.ToString()</div>
            @if (Model.Rank.Value <= 3)
            {
                <div class="rank-badge rank-@Model.Rank.Value">@(Model.Rank.Value == 1 ? "ðŸ¥‡" : Model.Rank.Value == 2 ? "ðŸ¥ˆ" : "ðŸ¥‰")</div>
            }
        </section>
    }

    <section class="column body">
        <div class="player-header">
            <span class="avatar-container">
                <img class="avatar hidden"
                     alt="@string.Format(WebResources.XsAvatar, player.Name)"
                     src="/avatar/player/@player.Id"
                     onload="this.classList.remove('hidden')"
                     onerror="this.style.display='none'"/>
            </span>
                   <div class="player-info">
                       <h3 class="player-name" style="@string.Join(';', styleParts)">
                           <a asp-page="/Player/PlayerProfile" asp-route-id="@player.Id" style="color: inherit; text-decoration: none;">@player.Name</a>
                       </h3>
                       <div class="player-class">@player.ClassName</div>
                   </div>
        </div>
        
        <div class="player-stats">
            <div class="stat-item">
                <span class="stat-label">Level</span>
                <span class="stat-value">@player.Level</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Experience</span>
                <span class="stat-value">@player.Exp.ToString("N0")</span>
            </div>
            @if (!string.IsNullOrWhiteSpace(player.Guild?.Name))
            {
                <div class="stat-item stat-guild">
                    <span class="stat-label">Guild</span>
                    <span class="stat-value">@player.Guild.Name</span>
                </div>
            }
        </div>
    </section>
</article>